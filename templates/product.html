{% extends "base.html" %}
{% block content %}
  <div class="product-detail">
    <div class="images">
      <img src="{{ product.images[0] }}" alt="{{ product.name }}">
    </div>

    <div class="meta">
      <h2>{{ product.name }}</h2>
      <p class="price">₹{{ "%.2f"|format(product.price) }}</p>
      <p>{{ product.description }}</p>

      <form action="{{ url_for('add_to_cart', product_id=product._id|string) }}" method="post">
        <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}">
        <button class="btn">Add to cart</button>
      </form>
    </div>
  </div>

  <section class="reviews">
    <h3>Reviews</h3>
    {% for r in reviews %}
      <div class="review">
        <strong>{{ r.username }}</strong> — {{ r.rating }}/5
        <p>{{ r.text }}</p>
      </div>
    {% endfor %}

    {% if session.get('username') %}
      <form action="{{ url_for('add_review', product_id=product._id|string) }}" method="post">
        <label>Rating:
          <select name="rating">
            {% for i in range(1,6) %}
              <option value="{{ i }}">{{ i }}</option>
            {% endfor %}
          </select>
        </label>

        <textarea name="review" placeholder="Write your review"></textarea>
        <button class="btn">Post review</button>
      </form>
    {% else %}
      <p><a href="{{ url_for('login') }}">Login</a> to post a review</p>
    {% endif %}
  </section>
{% endblock %}
